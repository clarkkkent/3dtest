# Цели для Я.Метрики и Google Analytics

## Важно

Основная суть - ставим элементам data-атрибуты с целями и ловим нужные события для передачи в системы аналитики.

Пример:

```html
<div data-goal-see="see_some_block">
    ...
</div>
```

В отличие от Я.Метрики в Google Analytics при передаче цели необходимо отдавать не только ее "наименование", 
но и "группу" цели/события. А у нас указывается всего 1 наименование.

Для того, чтобы корректно отдавать события в GA существует 2 варианта:

1. **Предпочтительный** - если в GA группе цели соответствует значение `some_group`, а цели - значение `some_event`, 
то для Я.Метрики можно указать в качестве идентификатора цели значение c некоторым разделителем. 
Например - `some_group__some_valie` (разделитель - двойное подчеркивание), `some_group--some-value` (разделитель-двойное тире). 
Этот способ позволит нам автоматически разобрать идентификатор цели и указать его корректно и для Я.М и для GA.
2. **Вынужденный** - если вариант 1 неосуществим (цели уже созданы, нет возможности ничего поменять), 
то тогда изменяем метод `goal(value)` и руками для каждого события определяем какие значения в какую систему аналитики уйдут.

### Типы событий

Типы событий, которые предусмотрены в данной версии:

- [Просмотр блока](#просмотр-блока)
- [Копирование контента (телефона, e-mail, адреса...)](#копирование-контента)
- [Клик на элементы (в тч на ссылки, кнопки)](#клик-на-элементы)
- [Наведение на элементы](#наведение-на-элементы)
- [Взаимодействие с формой (изменение параметров, ввод данных)](#взаимодействие-с-формой)
- [Успешная отправка формы (ajax-форма, форма в модальном окне)](#успешная-отправка-формы)

Теперь подробнее о каждом из типов событий

### Просмотр блока

Для проставления данной цели выбираем блок и навешиваем на него атрибут `data-goal-see` 
с нужным идентификатором цели

Пример:

```html
<div data-goal-see="see_some_block">
    ...
</div>
```

### Копирование контента

Для проставления данной цели выбираем блок и навешиваем на него атрибут `data-goal-copy` 
с нужным идентификатором цели

Примеры:

```html
<a data-goal-copy="copy_phone" href="tel:...">
    ...
</a>
```

```html
<a data-goal-copy="copy_mail" href="mailto:...">
    ...
</a>
```

```html
<div data-goal-copy="some_data_copied">
    ...
</div>
```

### Клик на элементы

Для проставления цели выбираем блок и навешиваем на него атрибут `data-goal-click` с нужным идентификатором цели

Примеры:

```html
<a data-goal-click="click_phone" href="tel:...">
    ...
</a>
```

```html
<div data-goal-click="something_clc">
    ...
</div>
```

Так же часто требуется отследить открытие формы во всплывающем окне - 
сделать это можно навесив атрибут `data-goal-click` с необходимым идентификатором цели на ссылку, вызывающую модальное окно:

```html
<a data-modal data-goal-click="modal_opened" href="...">
    ...
</a>
```

### Наведение на элементы

Для проставления цели выбираем блок и навешиваем на него атрибут `data-goal-hover` с нужным идентификатором цели

Примеры:

```html
<a data-goal-hover="hover_phone" href="tel:...">
    ...
</a>
```

```html
<div data-goal-click="something_hov">
    ...
</div>
```

### Взаимодействие с формой

Для проставления цели выбираем форму (или блок в котором находятся либо форма целиком, либо инпуты, которые мы хотим отслеживать) и навешиваем на него атрибут `data-goal-input` с нужным идентификатором цели

Примеры:

В данном примере будет отслеживаться активность сразу в двух формах:

```html
<div data-goal-input="input_some_data">
    <form action="">
        ...
    </form>
    <form action="">
        ...
    </form>
</div>
```

В данном примере будет отслеживаться активность в одной форме:

```html
<form action="" data-goal-input="input_some_data">
    ...
</form>
```


В данном примере будет отслеживаться активность только в первом поле:

```html
<form action="" data-goal-input="input_some_data">
    <div data-goal-input="input_some_data">
        <input type="text">
    </div>
    <div>
        <input type="text">
    </div>
</form>
```

### Успешная отправка формы

Тут чуть сложнее. Всего могут отслеживаться 2 типа форм:

1. Форма с `data-ajax-form`
2. Форма в модальном окне с `data-modal`

В первом случае необходимо указать атрибут `data-goal` с нужным идентификатором цели непосредственно форме:

```html
<form action="" data-ajax-form data-goal="successfully_sent_form">
    ...
</form>
```

Во втором случае необходимо указать атрибут `data-goal` с нужным идентификатором цели ссылке, 
которая открывает модальное окно:

```html
<a href="" data-modal data-goal="some_form_success">
    ...
</a>
```

В обоих случаях отправка события произойдет только после **успешной** отправки формы.
В случае возникновения ошибок валидации отправка события не произойдет.

## Всякие занятные мелочи

### Цели на отправку любой формы

В методе `goal(value)` отслеживаем события отправки необходимых форм и отправляем дополнительное событие.

### Цель на открытие всплывающего окна

Добавляем `data-goal-click="..."` на ссылку с `data-modal`. См. [Клик на элементы (в тч на ссылки, кнопки)](#клик-на-элементы)